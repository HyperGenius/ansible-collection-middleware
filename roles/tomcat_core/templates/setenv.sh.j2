#!/bin/sh
# ------------------------------------------------------------------------------
# Tomcat Environment Configuration (setenv.sh)
# Managed by Ansible (Role: tomcat_core)
# ------------------------------------------------------------------------------

# --- 1. Basic Memory Settings (From Ansible Variables) ---
{% if tomcat_core_heap_min is defined %}
CATALINA_OPTS="$CATALINA_OPTS -Xms{{ tomcat_core_heap_min }}"
{% endif %}
{% if tomcat_core_heap_max is defined %}
CATALINA_OPTS="$CATALINA_OPTS -Xmx{{ tomcat_core_heap_max }}"
{% endif %}

# --- 2. Global Options ---
{% if tomcat_core_java_opts is defined %}
CATALINA_OPTS="$CATALINA_OPTS {{ tomcat_core_java_opts }}"
{% endif %}

# --- 3. Extension Mechanism (The "setenv.d" Pattern) ---
SETENV_D="$CATALINA_HOME/bin/setenv.d"

if [ -d "$SETENV_D" ]; then
  for f in "$SETENV_D"/*.sh; do
    if [ -r "$f" ]; then
      . "$f"
    fi
  done
fi
